# sx-Road_Model
输入：5Min快照表
结构 msisdn--start_date_time--cgi
一：初始数据
（1）：基站数据聚类
基站数据根据经上报纬度坐标，用DBSCAN密度聚类，它将簇定义为密度相连的点的最大集合，能够把具有足够高密度的区域划分为簇。
（2）：构建泰森多边形
根据聚类之后的结果，将各个簇内的基站坐标取平均值，用Arcgis软件生成泰森多边形，泰森多边形内的所有基站赋予该泰森多边形编号。
用KDTree算法给每个泰森多边形中心点求取距离泰森多边形最近的三个路网点（osmid，来源OSM公开数据），最终得到cgi--taisen_id-osmid`~3
二：模型流程
（1）原始数据清洗
首先判断单个用户数据长度是否大于三，若小于则跳过，若大于，则判断该用户基站（30分钟）切换次数是否大于三，若小于则跳过，若大于则认定其为
道路移动用户。
再，将一个用户的头尾基站坐标求向量设定为l，然后依次将当前基站与下一时间段基站坐标向量与l求夹角，若夹角大于135度则认定该基站实际位置不可信
则删去下一时间段基站，暂时未做基站回填的工作。
（2）：得到用户路径
得到清洗后的数据后，将数据与第一步中完成的cgi-taisen_id-osmid联表进行匹配，得到新表字段如
msisdn--start_date_time--cgi--taisen_id--osmid，根据taisen_id再进行去重，去重规则为：
序列为：     AABBBCCC
去重保留：    A  BC   
根据最终得到结果，每三个最近osmid点之间与下三个osmid进行路径判断，取最短路径并保存，最终得到一串osmid
（3）：速度计算
根据路网数据（来源osm）,制作字典edge_dict,node_dict,分别保存两点之间边的长度length和该点的经纬度坐标（wgs84坐标系）
将用户的路径osmid同一个时间段下边与边之间的距离求和，除以这个时间间隔得到速度,并将这个速度全部赋予当前时间段下经历的osmid
最终得到是  msisdn--time--osmid--speed
（4）：街道人数统计
根据osmid的经纬度，编写爬虫，用经纬度逆地理编码爬取腾讯地图，获取osmid--street_name对应表
将用户osmid序列与表匹配，得到msisdn--time--osmid--street_name
三：结尾

最终得到的数据字段为：
msisdn-time-osmid-speed-street_name
并根据最终表进行结论分析，目前主要是进行历史分析，并有后续的实时监控（30分钟）的改写计划。
